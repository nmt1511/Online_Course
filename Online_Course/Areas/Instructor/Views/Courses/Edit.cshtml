@model Online_Course.ViewModels.InstructorEditCourseViewModel
@{
    ViewData["Title"] = "Sửa Thông tin Khóa học";
    Layout = "~/Views/Shared/_InstructorLayout.cshtml";
    var categories = ViewBag.Categories as IEnumerable<Online_Course.Models.Category> ?? new List<Online_Course.Models.Category>();
}

<div class="flex flex-col gap-6">
    <!-- Breadcrumbs -->
    <nav class="flex flex-wrap gap-2 items-center text-sm">
        <a asp-area="Instructor" asp-controller="Courses" asp-action="Index" 
           class="text-gray-500 dark:text-slate-400 hover:text-primary font-medium transition-colors flex items-center gap-1">
            <span class="material-symbols-outlined text-[18px]">school</span>
            Quản lý khóa học
        </a>
        <span class="text-gray-400 dark:text-slate-500">/</span>
        <span class="text-slate-900 dark:text-white font-medium">Sửa khóa học #@Model.CourseId</span>
    </nav>

    <!-- Page Heading & Actions -->
    <form asp-action="Edit" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="CourseId" />
        
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 pb-6 border-b border-gray-200 dark:border-slate-800">
            <div class="flex flex-col gap-2">
                <h1 class="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white">Sửa Thông tin Khóa học</h1>
                <p class="text-gray-500 dark:text-slate-400">Cập nhật tiêu đề, mô tả và hình ảnh hiển thị của khóa học.</p>
            </div>
            <div class="flex gap-3">
                <a asp-action="Index" class="px-5 py-2.5 rounded-lg bg-transparent border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white font-medium hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors flex items-center gap-2">
                    <span class="material-symbols-outlined text-[20px]">close</span>
                    Hủy bỏ
                </a>
                <button type="submit" class="px-5 py-2.5 rounded-lg bg-primary text-white font-medium shadow-lg shadow-primary/30 hover:bg-blue-600 transition-all flex items-center gap-2">
                    <span class="material-symbols-outlined text-[20px]">save</span>
                    Lưu thay đổi
                </button>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-6">
            <!-- Left Column: Form -->
            <div class="lg:col-span-2 flex flex-col gap-6">
                <!-- Title Input -->
                <div class="flex flex-col gap-2">
                    <label asp-for="Title" class="text-slate-900 dark:text-white text-base font-semibold"></label>
                    <div class="relative group">
                        <input asp-for="Title" 
                               class="w-full h-14 px-4 rounded-lg bg-gray-50 dark:bg-surface-dark border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-slate-500 focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none"
                               placeholder="Ví dụ: Nhập môn Lập trình Web với React" />
                        <div class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-slate-400 pointer-events-none group-focus-within:text-primary transition-colors">
                            <span class="material-symbols-outlined">edit</span>
                        </div>
                    </div>
                    <span asp-validation-for="Title" class="text-red-500 text-sm"></span>
                </div>

                <!-- Category Select -->
                <div class="flex flex-col gap-2">
                    <label asp-for="CategoryId" class="text-slate-900 dark:text-white text-base font-semibold">Danh mục</label>
                    <select asp-for="CategoryId" class="w-full h-14 px-4 rounded-lg bg-gray-50 dark:bg-surface-dark border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none">
                        <option value="">-- Chọn danh mục --</option>
                        @foreach (var category in categories)
                        {
                            <option value="@category.CategoryId" selected="@(Model.CategoryId == category.CategoryId)">@category.Name</option>
                        }
                    </select>
                    <span asp-validation-for="CategoryId" class="text-red-500 text-sm"></span>
                </div>

                <!-- Thumbnail Image -->
                <div class="flex flex-col gap-2">
                    <label class="text-slate-900 dark:text-white text-base font-semibold flex items-center justify-between">
                        Ảnh bìa khóa học
                        <span class="text-xs font-normal text-gray-500 dark:text-slate-400 bg-gray-100 dark:bg-slate-800 px-2 py-1 rounded">Khuyến nghị tỉ lệ 16:9</span>
                    </label>
                    
                    <!-- Tab buttons -->
                    <div class="flex gap-2 mb-2">
                        <button type="button" id="tab-upload" onclick="switchTab('upload')" class="px-4 py-2 text-sm font-medium rounded-lg bg-primary text-white transition-colors">
                            <span class="material-symbols-outlined text-sm align-middle mr-1">upload</span>
                            Upload từ máy
                        </button>
                        <button type="button" id="tab-url" onclick="switchTab('url')" class="px-4 py-2 text-sm font-medium rounded-lg bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-slate-300 hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors">
                            <span class="material-symbols-outlined text-sm align-middle mr-1">link</span>
                            Nhập URL
                        </button>
                    </div>
                    
                    <!-- Upload file -->
                    <div id="panel-upload" class="block">
                        <div class="border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-lg p-6 text-center hover:border-primary transition-colors">
                            <input type="file" name="thumbnailFile" id="thumbnailFile" accept="image/*" class="hidden" onchange="previewUploadedImage(this)" />
                            <label for="thumbnailFile" class="cursor-pointer">
                                <span class="material-symbols-outlined text-4xl text-gray-400 dark:text-slate-500 mb-2">cloud_upload</span>
                                <p class="text-gray-500 dark:text-slate-400 text-sm">Kéo thả hoặc click để chọn ảnh mới</p>
                                <p class="text-gray-400 dark:text-slate-500 text-xs mt-1">PNG, JPG, GIF (tối đa 5MB)</p>
                            </label>
                            <img id="upload-preview" class="hidden mt-4 mx-auto max-h-32 rounded-lg" />
                        </div>
                    </div>
                    
                    <!-- URL input -->
                    <div id="panel-url" class="hidden">
                        <div class="relative">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-slate-400">
                                <span class="material-symbols-outlined text-[20px]">link</span>
                            </span>
                            <input asp-for="ThumbnailUrl" 
                                   class="w-full h-14 pl-11 pr-4 rounded-lg bg-gray-50 dark:bg-surface-dark border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-slate-500 focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none"
                                   placeholder="https://example.com/image.jpg" />
                        </div>
                    </div>
                    <span asp-validation-for="ThumbnailUrl" class="text-red-500 text-sm"></span>
                    
                    @if (!string.IsNullOrEmpty(Model.ThumbnailUrl))
                    {
                        <p class="text-sm text-gray-500 dark:text-slate-400">Ảnh hiện tại: <a href="@Model.ThumbnailUrl" target="_blank" class="text-primary hover:underline">@Model.ThumbnailUrl</a></p>
                    }
                </div>

                <!-- Description Editor -->
                <div class="flex flex-col gap-2">
                    <label asp-for="Description" class="text-slate-900 dark:text-white text-base font-semibold"></label>
                    <div class="flex flex-col rounded-lg border border-gray-200 dark:border-slate-700 overflow-hidden bg-gray-50 dark:bg-surface-dark focus-within:border-primary focus-within:ring-1 focus-within:ring-primary transition-all">
                        <!-- Toolbar -->
                        <div class="flex items-center gap-1 p-2 border-b border-gray-200 dark:border-slate-800 bg-gray-100 dark:bg-slate-900/50">
                            <button type="button" class="p-1.5 rounded hover:bg-gray-200 dark:hover:bg-slate-700 text-gray-500 dark:text-slate-400 transition-colors" title="Bold">
                                <span class="material-symbols-outlined text-[20px]">format_bold</span>
                            </button>
                            <button type="button" class="p-1.5 rounded hover:bg-gray-200 dark:hover:bg-slate-700 text-gray-500 dark:text-slate-400 transition-colors" title="Italic">
                                <span class="material-symbols-outlined text-[20px]">format_italic</span>
                            </button>
                            <button type="button" class="p-1.5 rounded hover:bg-gray-200 dark:hover:bg-slate-700 text-gray-500 dark:text-slate-400 transition-colors" title="Underline">
                                <span class="material-symbols-outlined text-[20px]">format_underlined</span>
                            </button>
                            <div class="w-px h-5 bg-gray-300 dark:bg-slate-700 mx-1"></div>
                            <button type="button" class="p-1.5 rounded hover:bg-gray-200 dark:hover:bg-slate-700 text-gray-500 dark:text-slate-400 transition-colors" title="List">
                                <span class="material-symbols-outlined text-[20px]">format_list_bulleted</span>
                            </button>
                        </div>
                        <!-- Textarea -->
                        <textarea asp-for="Description" 
                                  class="w-full min-h-[200px] p-4 bg-transparent border-none outline-none resize-y text-slate-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-slate-500 leading-relaxed"
                                  placeholder="Nhập nội dung mô tả khóa học..."></textarea>
                    </div>
                    <span asp-validation-for="Description" class="text-red-500 text-sm"></span>
                </div>

                <!-- Status Select -->
                <div class="flex flex-col gap-2">
                    <label asp-for="Status" class="text-slate-900 dark:text-white text-base font-semibold">Trạng thái khóa học</label>
                    <select asp-for="Status" class="w-full h-14 px-4 rounded-lg bg-gray-50 dark:bg-surface-dark border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none">
                        <option value="@Online_Course.Models.CourseStatus.Draft">Nháp - Chưa công khai</option>
                        <option value="@Online_Course.Models.CourseStatus.Private">Riêng tư - Chỉ học viên được mời</option>
                        <option value="@Online_Course.Models.CourseStatus.Public">Công khai - Mọi người có thể xem</option>
                    </select>
                    <p class="text-gray-500 dark:text-slate-400 text-sm">Chọn trạng thái hiển thị của khóa học.</p>
                </div>

                <!-- Course Type -->
                <div class="flex flex-col gap-2">
                    <label asp-for="CourseType" class="text-slate-900 dark:text-white text-base font-semibold">Loại khóa học</label>
                    <select asp-for="CourseType" id="courseTypeSelect" class="w-full h-14 px-4 rounded-lg bg-gray-50 dark:bg-surface-dark border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none">
                        <option value="@Online_Course.Models.CourseType.Open_Always">Mở xuyên suốt</option>
                        <option value="@Online_Course.Models.CourseType.Fixed_Time">Thời gian cố định</option>
                    </select>
                    <p class="text-gray-500 dark:text-slate-400 text-sm">Chọn "Thời gian cố định" nếu khóa học có thời gian đăng ký và học cụ thể.</p>
                </div>

                <!-- Date Fields (shown only for Fixed_Time) -->
                <div id="dateFieldsSection" class="@(Model.CourseType == Online_Course.Models.CourseType.Fixed_Time ? "" : "hidden") flex flex-col gap-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
                    <h3 class="text-sm font-semibold text-slate-900 dark:text-white flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">calendar_month</span>
                        Thời gian khóa học
                    </h3>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <!-- Registration Start Date -->
                        <div class="flex flex-col gap-1">
                            <label asp-for="RegistrationStartDate" class="text-slate-900 dark:text-white text-sm font-medium">Ngày bắt đầu đăng ký <span class="text-red-500">*</span></label>
                            <input asp-for="RegistrationStartDate" type="date" class="w-full h-12 px-4 rounded-lg bg-white dark:bg-background-dark border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none" />
                            <span asp-validation-for="RegistrationStartDate" class="text-red-500 text-xs"></span>
                        </div>

                        <!-- Registration End Date -->
                        <div class="flex flex-col gap-1">
                            <label asp-for="RegistrationEndDate" class="text-slate-900 dark:text-white text-sm font-medium">Ngày kết thúc đăng ký <span class="text-red-500">*</span></label>
                            <input asp-for="RegistrationEndDate" type="date" class="w-full h-12 px-4 rounded-lg bg-white dark:bg-background-dark border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none" />
                            <span asp-validation-for="RegistrationEndDate" class="text-red-500 text-xs"></span>
                        </div>

                        <!-- Start Date -->
                        <div class="flex flex-col gap-1">
                            <label asp-for="StartDate" class="text-slate-900 dark:text-white text-sm font-medium">Ngày bắt đầu học <span class="text-red-500">*</span></label>
                            <input asp-for="StartDate" type="date" class="w-full h-12 px-4 rounded-lg bg-white dark:bg-background-dark border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none" />
                            <span asp-validation-for="StartDate" class="text-red-500 text-xs"></span>
                        </div>

                        <!-- End Date -->
                        <div class="flex flex-col gap-1">
                            <label asp-for="EndDate" class="text-slate-900 dark:text-white text-sm font-medium">Ngày kết thúc học <span class="text-red-500">*</span></label>
                            <input asp-for="EndDate" type="date" class="w-full h-12 px-4 rounded-lg bg-white dark:bg-background-dark border border-gray-200 dark:border-slate-700 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary transition-all outline-none" />
                            <span asp-validation-for="EndDate" class="text-red-500 text-xs"></span>
                        </div>
                    </div>
                    
                    <p class="text-xs text-gray-500 dark:text-slate-400">
                        <span class="material-symbols-outlined text-xs align-middle mr-1">info</span>
                        Thứ tự: Ngày bắt đầu đăng ký → Ngày kết thúc đăng ký → Ngày bắt đầu học → Ngày kết thúc học
                    </p>
                </div>

            </div>


            <!-- Right Column: Preview & Stats -->
            <div class="lg:col-span-1 flex flex-col gap-6">
                <!-- Preview Card -->
                <div class="flex flex-col gap-3 sticky top-24">
                    <h3 class="text-slate-900 dark:text-white text-base font-semibold flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">visibility</span>
                        Xem trước thẻ khóa học
                    </h3>
                    <div class="bg-white dark:bg-surface-dark rounded-xl overflow-hidden border border-gray-200 dark:border-slate-700 shadow-lg transition-transform hover:-translate-y-1 duration-300">
                        <!-- Image Container -->
                        <div class="aspect-video w-full bg-gray-200 dark:bg-slate-800 relative group cursor-pointer overflow-hidden">
                            <img id="preview-image" 
                                 src="@(string.IsNullOrEmpty(Model.ThumbnailUrl) ? "https://via.placeholder.com/400x225?text=Course+Preview" : Model.ThumbnailUrl)" 
                                 alt="Course thumbnail preview" 
                                 class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                                 onerror="this.src='https://via.placeholder.com/400x225?text=Invalid+URL'" />
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                <span class="bg-white/20 backdrop-blur-sm p-2 rounded-full text-white">
                                    <span class="material-symbols-outlined">zoom_in</span>
                                </span>
                            </div>
                        </div>
                        <!-- Card Content Preview -->
                        <div class="p-4 flex flex-col gap-3">
                            <div class="flex items-center gap-2 text-xs font-semibold text-primary uppercase tracking-wider">
                                <span id="preview-category" class="bg-primary/10 px-2 py-0.5 rounded">@(Model.CategoryId.HasValue ? categories.FirstOrDefault(c => c.CategoryId == Model.CategoryId)?.Name ?? "Category" : "Category")</span>
                            </div>
                            <h4 id="preview-title" class="text-slate-900 dark:text-white font-bold text-lg line-clamp-2 leading-tight">@(string.IsNullOrEmpty(Model.Title) ? "Tiêu đề khóa học" : Model.Title)</h4>
                            <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-slate-400">
                                <div class="size-6 rounded-full bg-primary/20 flex items-center justify-center text-primary text-xs font-bold">
                                    @(Model.InstructorName.Length > 0 ? Model.InstructorName[0].ToString().ToUpper() : "I")
                                </div>
                                <span>@Model.InstructorName</span>
                            </div>
                            <div class="pt-3 mt-1 border-t border-gray-200 dark:border-slate-700 flex items-center justify-between text-xs text-gray-500 dark:text-slate-400">
                                <div class="flex items-center gap-1">
                                    <span class="material-symbols-outlined text-[16px]">group</span>
                                    <span>@Model.EnrollmentCount học viên</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span class="material-symbols-outlined text-[16px]">play_lesson</span>
                                    <span>@Model.LessonCount bài học</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Box -->
                    <div class="@(Model.Status == Online_Course.Models.CourseStatus.Public ? "bg-green-500/10 border-green-500/20" : Model.Status == Online_Course.Models.CourseStatus.Private ? "bg-yellow-500/10 border-yellow-500/20" : "bg-blue-500/10 border-blue-500/20") border rounded-lg p-4 mt-2">
                        <div class="flex gap-3">
                            <span class="material-symbols-outlined @(Model.Status == Online_Course.Models.CourseStatus.Public ? "text-green-500" : Model.Status == Online_Course.Models.CourseStatus.Private ? "text-yellow-500" : "text-primary") mt-0.5">info</span>
                            <div>
                                <p class="text-sm font-semibold text-slate-900 dark:text-white mb-1">Trạng thái khóa học</p>
                                @if (Model.Status == Online_Course.Models.CourseStatus.Public)
                                {
                                    <p class="text-sm text-gray-500 dark:text-slate-400 leading-snug">Khóa học này đang ở trạng thái <strong class="text-green-500">Công khai</strong>.</p>
                                }
                                else if (Model.Status == Online_Course.Models.CourseStatus.Private)
                                {
                                    <p class="text-sm text-gray-500 dark:text-slate-400 leading-snug">Khóa học này đang ở trạng thái <strong class="text-yellow-500">Riêng tư</strong>.</p>
                                }
                                else
                                {
                                    <p class="text-sm text-gray-500 dark:text-slate-400 leading-snug">Khóa học này đang ở trạng thái <strong class="text-primary">Nháp</strong>. Hãy hoàn thiện nội dung trước khi xuất bản.</p>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Quick Links -->
                    <div class="flex flex-col gap-2 mt-2">
                        <a asp-area="Instructor" asp-controller="Lessons" asp-action="Index" asp-route-courseId="@Model.CourseId"
                           class="flex items-center gap-3 p-3 bg-white dark:bg-surface-dark rounded-lg border border-gray-200 dark:border-slate-700 hover:border-primary/50 transition-colors">
                            <span class="material-symbols-outlined text-primary">menu_book</span>
                            <div>
                                <p class="text-slate-900 dark:text-white font-medium text-sm">Quản lý bài học</p>
                                <p class="text-gray-500 dark:text-slate-400 text-xs">@Model.LessonCount bài học</p>
                            </div>
                            <span class="material-symbols-outlined text-gray-400 dark:text-slate-500 ml-auto">chevron_right</span>
                        </a>
                        <a asp-area="Instructor" asp-controller="Students" asp-action="Index" asp-route-courseId="@Model.CourseId"
                           class="flex items-center gap-3 p-3 bg-white dark:bg-surface-dark rounded-lg border border-gray-200 dark:border-slate-700 hover:border-primary/50 transition-colors">
                            <span class="material-symbols-outlined text-orange-400">group</span>
                            <div>
                                <p class="text-slate-900 dark:text-white font-medium text-sm">Học viên & Tiến độ</p>
                                <p class="text-gray-500 dark:text-slate-400 text-xs">@Model.EnrollmentCount học viên</p>
                            </div>
                            <span class="material-symbols-outlined text-gray-400 dark:text-slate-500 ml-auto">chevron_right</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // CourseType toggle functionality
        function toggleDateFields() {
            const courseTypeSelect = document.getElementById('courseTypeSelect');
            const dateFieldsSection = document.getElementById('dateFieldsSection');
            
            if (courseTypeSelect.value === '@((int)Online_Course.Models.CourseType.Fixed_Time)' || 
                courseTypeSelect.value === 'Fixed_Time') {
                dateFieldsSection.classList.remove('hidden');
            } else {
                dateFieldsSection.classList.add('hidden');
                // Clear date fields when switching to Open_Always
                document.getElementById('RegistrationStartDate').value = '';
                document.getElementById('RegistrationEndDate').value = '';
                document.getElementById('StartDate').value = '';
                document.getElementById('EndDate').value = '';
            }
        }
        
        // Date validation
        function validateDates() {
            const courseTypeSelect = document.getElementById('courseTypeSelect');
            if (courseTypeSelect.value !== '@((int)Online_Course.Models.CourseType.Fixed_Time)' && 
                courseTypeSelect.value !== 'Fixed_Time') {
                return true;
            }
            
            const regStart = new Date(document.getElementById('RegistrationStartDate').value);
            const regEnd = new Date(document.getElementById('RegistrationEndDate').value);
            const startDate = new Date(document.getElementById('StartDate').value);
            const endDate = new Date(document.getElementById('EndDate').value);
            
            let errors = [];
            
            if (!document.getElementById('RegistrationStartDate').value || 
                !document.getElementById('RegistrationEndDate').value ||
                !document.getElementById('StartDate').value || 
                !document.getElementById('EndDate').value) {
                errors.push('Vui lòng nhập đầy đủ các ngày khi chọn loại khóa học thời gian cố định.');
            } else {
                if (regStart >= regEnd) {
                    errors.push('Ngày kết thúc đăng ký phải sau ngày bắt đầu đăng ký.');
                }
                if (regEnd >= startDate) {
                    errors.push('Ngày bắt đầu học phải sau ngày kết thúc đăng ký.');
                }
                if (startDate >= endDate) {
                    errors.push('Ngày kết thúc học phải sau ngày bắt đầu học.');
                }
            }
            
            if (errors.length > 0) {
                alert(errors.join('\n'));
                return false;
            }
            
            return true;
        }
        
        // Live preview updates
        document.getElementById('Title').addEventListener('input', function() {
            document.getElementById('preview-title').textContent = this.value || 'Tiêu đề khóa học';
        });
        
        document.getElementById('Category').addEventListener('change', function() {
            document.getElementById('preview-category').textContent = this.value || 'Category';
        });
        
        document.getElementById('ThumbnailUrl').addEventListener('input', function() {
            var img = document.getElementById('preview-image');
            img.src = this.value || 'https://via.placeholder.com/400x225?text=Course+Preview';
        });
        
        function switchTab(tab) {
            const tabUpload = document.getElementById('tab-upload');
            const tabUrl = document.getElementById('tab-url');
            const panelUpload = document.getElementById('panel-upload');
            const panelUrl = document.getElementById('panel-url');
            
            if (tab === 'upload') {
                tabUpload.className = 'px-4 py-2 text-sm font-medium rounded-lg bg-primary text-white transition-colors';
                tabUrl.className = 'px-4 py-2 text-sm font-medium rounded-lg bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-slate-300 hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors';
                panelUpload.classList.remove('hidden');
                panelUrl.classList.add('hidden');
            } else {
                tabUrl.className = 'px-4 py-2 text-sm font-medium rounded-lg bg-primary text-white transition-colors';
                tabUpload.className = 'px-4 py-2 text-sm font-medium rounded-lg bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-slate-300 hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors';
                panelUrl.classList.remove('hidden');
                panelUpload.classList.add('hidden');
            }
        }
        
        function previewUploadedImage(input) {
            const preview = document.getElementById('upload-preview');
            const mainPreview = document.getElementById('preview-image');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    if (mainPreview) {
                        mainPreview.src = e.target.result;
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const courseTypeSelect = document.getElementById('courseTypeSelect');
            
            // Add event listener for CourseType change
            courseTypeSelect.addEventListener('change', toggleDateFields);
            
            // Form submission validation
            form.addEventListener('submit', function(e) {
                if (!validateDates()) {
                    e.preventDefault();
                    return false;
                }
            });
        });
    </script>
}

