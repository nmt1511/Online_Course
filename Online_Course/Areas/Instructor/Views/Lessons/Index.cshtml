@model Online_Course.ViewModels.LessonListViewModel
@using Online_Course.Models
@{
    ViewData["Title"] = "Quản lý Bài học";
    Layout = "~/Views/Shared/_InstructorLayout.cshtml";
}

<!-- Breadcrumbs -->
<div class="flex items-center gap-2 text-sm mb-6">
    <a asp-area="Instructor" asp-controller="Courses" asp-action="Index" class="text-gray-500 dark:text-slate-400 hover:text-primary transition-colors">Quản lý khóa học</a>
    <span class="material-symbols-outlined text-gray-400 dark:text-slate-500 text-[16px]">chevron_right</span>
    <a asp-area="Instructor" asp-controller="Courses" asp-action="Edit" asp-route-id="@Model.CourseId" class="text-gray-500 dark:text-slate-400 hover:text-primary transition-colors">@Model.CourseTitle</a>
    <span class="material-symbols-outlined text-gray-400 dark:text-slate-500 text-[16px]">chevron_right</span>
    <span class="text-primary font-medium">Quản lý bài học</span>
</div>

<!-- Header -->
<div class="flex flex-wrap justify-between items-center gap-4 mb-6">
    <div>
        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Danh sách bài học</h1>
        <p class="text-gray-500 dark:text-slate-400 text-sm mt-1">Khóa học: @Model.CourseTitle</p>
    </div>
    <div class="flex items-center gap-3">
        <span class="text-xs bg-primary/10 text-primary px-3 py-1.5 rounded-lg font-medium">
            @Model.Lessons.Count() Bài học
        </span>
        <a asp-action="Create" asp-route-courseId="@Model.CourseId" 
           class="flex items-center gap-2 px-4 py-2.5 rounded-lg bg-primary text-white text-sm font-medium hover:bg-blue-600 transition-colors shadow-lg shadow-primary/20">
            <span class="material-symbols-outlined text-[18px]">add</span>
            <span>Thêm bài học</span>
        </a>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="mb-6 p-4 rounded-lg bg-green-500/10 border border-green-500/20 text-green-600 dark:text-green-400 flex items-center gap-3">
        <span class="material-symbols-outlined">check_circle</span>
        <span>@TempData["SuccessMessage"]</span>
    </div>
}

<!-- Lessons List -->
<div class="bg-white dark:bg-surface-dark rounded-xl border border-gray-200 dark:border-slate-700/50 overflow-hidden">
    @if (!Model.Lessons.Any())
    {
        <div class="p-12 text-center">
            <div class="size-16 rounded-full bg-gray-100 dark:bg-slate-800 flex items-center justify-center mx-auto mb-4">
                <span class="material-symbols-outlined text-gray-400 dark:text-slate-500 text-[32px]">library_books</span>
            </div>
            <h3 class="text-slate-900 dark:text-white font-medium mb-2">Chưa có bài học nào</h3>
            <p class="text-gray-500 dark:text-slate-400 text-sm mb-6">Bắt đầu tạo bài học đầu tiên cho khóa học của bạn</p>
            <a asp-action="Create" asp-route-courseId="@Model.CourseId" 
               class="inline-flex items-center gap-2 px-4 py-2.5 rounded-lg bg-primary text-white text-sm font-medium hover:bg-blue-600 transition-colors">
                <span class="material-symbols-outlined text-[18px]">add</span>
                <span>Thêm bài học mới</span>
            </a>
        </div>
    }
    else
    {
        <div class="divide-y divide-gray-200 dark:divide-slate-700/50">
            @foreach (var lesson in Model.Lessons.OrderBy(l => l.OrderIndex))
            {
                <div class="group flex items-center gap-4 p-4 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
                    <!-- Drag Handle -->
                    <span class="material-symbols-outlined text-gray-400 dark:text-slate-500 cursor-grab text-[20px] opacity-0 group-hover:opacity-100 transition-opacity">drag_indicator</span>
                    
                    <!-- Lesson Type Icon -->
                    @if (lesson.LessonType == LessonType.Pdf)
                    {
                        <div class="size-10 rounded-lg bg-red-100 dark:bg-red-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="material-symbols-outlined text-red-500 text-[20px]">picture_as_pdf</span>
                        </div>
                    }
                    else
                    {
                        <div class="size-10 rounded-lg bg-blue-100 dark:bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="material-symbols-outlined text-blue-500 text-[20px]">smart_display</span>
                        </div>
                    }
                    
                    <!-- Lesson Info -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xs text-primary font-medium">Bài @lesson.OrderIndex</span>
                            @if (lesson.LessonType == LessonType.Pdf)
                            {
                                <span class="text-xs bg-red-100 dark:bg-red-500/20 text-red-600 dark:text-red-400 px-2 py-0.5 rounded font-medium">PDF</span>
                            }
                            else
                            {
                                <span class="text-xs bg-blue-100 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400 px-2 py-0.5 rounded font-medium">Video</span>
                            }
                        </div>
                        <h3 class="text-slate-900 dark:text-white font-medium truncate">@lesson.Title</h3>
                        @if (!string.IsNullOrEmpty(lesson.Description))
                        {
                            <p class="text-gray-500 dark:text-slate-400 text-sm truncate mt-1">@lesson.Description</p>
                        }
                    </div>
                    
                    <!-- Lesson Metadata -->
                    <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-slate-400">
                        @if (lesson.LessonType == LessonType.Pdf && lesson.TotalPages.HasValue)
                        {
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-[16px]">description</span>
                                <span>@lesson.TotalPages trang</span>
                            </div>
                        }
                        else if (lesson.LessonType == LessonType.Video && lesson.TotalDurationSeconds.HasValue)
                        {
                            var mins = lesson.TotalDurationSeconds.Value / 60;
                            var secs = lesson.TotalDurationSeconds.Value % 60;
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-[16px]">timer</span>
                                <span>@mins:@secs.ToString("D2")</span>
                            </div>
                        }
                    </div>
                    
                    <!-- Actions -->
                    <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <a asp-area="Instructor" asp-controller="Lessons" asp-action="Edit" asp-route-id="@lesson.LessonId" 
                           class="size-9 rounded-lg flex items-center justify-center bg-gray-100 dark:bg-slate-700/50 text-gray-600 dark:text-slate-300 hover:bg-primary hover:text-white transition-colors"
                           title="Chỉnh sửa">
                            <span class="material-symbols-outlined text-[18px]">edit</span>
                        </a>
                        <form asp-action="Delete" asp-route-id="@lesson.LessonId" method="post" class="inline delete-form">
                            @Html.AntiForgeryToken()
                            <button type="button" onclick="showConfirmDialog(this.closest('form'), 'Xóa bài học', 'Bạn có chắc chắn muốn xóa bài học này? Tiến độ học của học viên liên quan sẽ bị xóa.', 'Xóa', 'danger')" 
                                    class="size-9 rounded-lg flex items-center justify-center bg-gray-100 dark:bg-slate-700/50 text-gray-600 dark:text-slate-300 hover:bg-red-500 hover:text-white transition-colors"
                                    title="Xóa">
                                <span class="material-symbols-outlined text-[18px]">delete</span>
                            </button>
                        </form>
                    </div>
                </div>
            }
        </div>
    }
</div>

<!-- Back Button -->
<div class="mt-6">
    <a asp-area="Instructor" asp-controller="Courses" asp-action="Index" 
       class="inline-flex items-center gap-2 text-gray-500 dark:text-slate-400 hover:text-primary transition-colors">
        <span class="material-symbols-outlined text-[18px]">arrow_back</span>
        <span>Quay lại Quản lý khóa học</span>
    </a>
</div>
