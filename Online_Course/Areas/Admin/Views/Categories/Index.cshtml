@model Online_Course.ViewModels.CategoryIndexViewModel
@{
    ViewData["Title"] = "Quản lý danh mục";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="max-w-[1400px] mx-auto flex flex-col gap-8">
    <!-- Breadcrumbs -->
    <div class="flex flex-wrap gap-2">
        <a asp-area="Admin" asp-controller="Dashboard" asp-action="Index" class="text-[#9dabb9] text-sm font-medium hover:text-white transition-colors">Trang chủ</a>
        <span class="text-[#9dabb9] text-sm font-medium">/</span>
        <span class="text-white text-sm font-medium">Danh mục</span>
    </div>

    <!-- Page Header -->
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
        <div class="flex flex-col gap-2">
            <h1 class="text-white text-3xl md:text-4xl font-bold leading-tight tracking-tight">Quản lý danh mục</h1>
            <p class="text-[#9dabb9] text-base font-normal">Quản lý và tổ chức các danh mục khóa học cho nền tảng.</p>
        </div>
        <button type="button" onclick="openAddModal()" class="flex items-center justify-center gap-2 bg-primary hover:bg-primary/90 text-white px-5 py-2.5 rounded-lg font-medium transition-colors shadow-lg shadow-primary/20 whitespace-nowrap">
            <span class="material-symbols-outlined text-[20px]">add</span>
            <span>Thêm danh mục mới</span>
        </button>
    </div>

    <!-- Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="bg-green-500/20 border border-green-500/30 text-green-400 px-4 py-3 rounded-lg flex items-center gap-2">
            <span class="material-symbols-outlined">check_circle</span>
            <span>@TempData["SuccessMessage"]</span>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="bg-red-500/20 border border-red-500/30 text-red-400 px-4 py-3 rounded-lg flex items-center gap-2">
            <span class="material-symbols-outlined">error</span>
            <span>@TempData["ErrorMessage"]</span>
        </div>
    }


    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="flex flex-col gap-1 rounded-xl p-5 border border-[#3b4754] bg-[#283039]/30">
            <div class="flex items-center gap-2 mb-1">
                <span class="material-symbols-outlined text-primary">folder</span>
                <p class="text-[#9dabb9] text-sm font-medium">Tổng danh mục</p>
            </div>
            <p class="text-white text-2xl font-bold">@Model.TotalCategories</p>
        </div>
        <div class="flex flex-col gap-1 rounded-xl p-5 border border-[#3b4754] bg-[#283039]/30">
            <div class="flex items-center gap-2 mb-1">
                <span class="material-symbols-outlined text-green-400">check_circle</span>
                <p class="text-[#9dabb9] text-sm font-medium">Đang hoạt động (có khóa học)</p>
            </div>
            <p class="text-white text-2xl font-bold">@Model.ActiveCategories</p>
        </div>
        <div class="flex flex-col gap-1 rounded-xl p-5 border border-[#3b4754] bg-[#283039]/30">
            <div class="flex items-center gap-2 mb-1">
                <span class="material-symbols-outlined text-orange-400">inbox</span>
                <p class="text-[#9dabb9] text-sm font-medium">Trống</p>
            </div>
            <p class="text-white text-2xl font-bold">@Model.EmptyCategories</p>
        </div>
    </div>

    <!-- Search Toolbar -->
    <div class="flex flex-col sm:flex-row gap-4">
        <form asp-action="Index" method="get" class="flex-1">
            <div class="flex-1 relative">
                <label class="flex w-full items-center rounded-lg bg-[#283039] border border-transparent focus-within:border-primary/50 focus-within:ring-1 focus-within:ring-primary/50 transition-all overflow-hidden h-12">
                    <div class="pl-4 pr-2 flex items-center justify-center text-[#9dabb9]">
                        <span class="material-symbols-outlined">search</span>
                    </div>
                    <input type="text" name="search" value="@Model.SearchQuery" class="w-full bg-transparent border-none text-white placeholder-[#9dabb9] focus:ring-0 px-2 h-full text-base" placeholder="Tìm kiếm theo tên danh mục..."/>
                </label>
            </div>
        </form>
    </div>


    <!-- Data Table -->
    <div class="rounded-xl border border-[#3b4754] bg-[#283039]/20 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead class="bg-[#283039] border-b border-[#3b4754]">
                    <tr>
                        <th class="p-4 text-sm font-semibold text-[#9dabb9] w-16">ID</th>
                        <th class="p-4 text-sm font-semibold text-[#9dabb9] min-w-[200px]">Tên danh mục</th>
                        <th class="p-4 text-sm font-semibold text-[#9dabb9] hidden md:table-cell">Slug</th>
                        <th class="p-4 text-sm font-semibold text-[#9dabb9] text-center">Khóa học</th>
                        <th class="p-4 text-sm font-semibold text-[#9dabb9]">Trạng thái</th>
                        <th class="p-4 text-sm font-semibold text-[#9dabb9] hidden lg:table-cell">Ngày tạo</th>
                        <th class="p-4 text-sm font-semibold text-[#9dabb9] text-right">Thao tác</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-[#3b4754]">
                    @foreach (var category in Model.Categories)
                    {
                        <tr class="group hover:bg-[#283039]/50 transition-colors">
                            <td class="p-4 text-[#9dabb9] text-sm">#@category.CategoryId.ToString("D3")</td>
                            <td class="p-4">
                                <div class="flex items-center gap-3">
                                    <div class="size-10 rounded-lg bg-[#283039] flex items-center justify-center border border-[#3b4754]">
                                        <span class="material-symbols-outlined text-primary">category</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-white font-medium">@category.Name</span>
                                        <span class="text-xs text-[#9dabb9] md:hidden">@category.Slug</span>
                                    </div>
                                </div>
                            </td>
                            <td class="p-4 text-[#9dabb9] text-sm hidden md:table-cell">@category.Slug</td>
                            <td class="p-4 text-white text-sm font-medium text-center">@category.CourseCount</td>
                            <td class="p-4">
                                @if (category.CourseCount > 0)
                                {
                                    <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-green-500/10 text-green-400 border border-green-500/20">
                                        <span class="size-1.5 rounded-full bg-green-400"></span>
                                        Hoạt động
                                    </span>
                                }
                                else
                                {
                                    <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-[#283039] text-[#9dabb9] border border-[#3b4754]">
                                        <span class="size-1.5 rounded-full bg-[#9dabb9]"></span>
                                        Trống
                                    </span>
                                }
                            </td>
                            <td class="p-4 text-[#9dabb9] text-sm hidden lg:table-cell">@category.CreatedAt.ToString("MMM dd, yyyy")</td>
                            <td class="p-4 text-right">
                                <div class="flex items-center justify-end gap-2 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity">
                                    <a asp-action="Edit" asp-route-id="@category.CategoryId" class="p-2 rounded-lg text-[#9dabb9] hover:text-primary hover:bg-primary/10 transition-colors" title="Chỉnh sửa">
                                        <span class="material-symbols-outlined text-[20px]">edit</span>
                                    </a>
                                    <form asp-action="Delete" asp-route-id="@category.CategoryId" method="post" class="inline delete-form">
                                        @Html.AntiForgeryToken()
                                        <button type="button" onclick="showConfirmDialog(this.closest('form'), 'Xóa danh mục', 'Bạn có chắc chắn muốn xóa danh mục này?', 'Xóa', 'danger')" class="p-2 rounded-lg text-[#9dabb9] hover:text-red-400 hover:bg-red-400/10 transition-colors" title="Xóa">
                                            <span class="material-symbols-outlined text-[20px]">delete</span>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        @if (!Model.Categories.Any())
        {
            <div class="p-8 text-center text-[#9dabb9]">
                <span class="material-symbols-outlined text-4xl mb-2">folder_off</span>
                <p>Không tìm thấy danh mục</p>
            </div>
        }
    </div>
</div>


<!-- Add Category Modal -->
<div id="addCategoryModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-[#1a222c] border border-[#3b4754] rounded-xl p-6 w-full max-w-md mx-4">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-white text-xl font-bold">Thêm danh mục mới</h3>
            <button type="button" onclick="closeAddModal()" class="text-[#9dabb9] hover:text-white transition-colors">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <form asp-action="Create" method="post">
            @Html.AntiForgeryToken()
            <div class="mb-6">
                <label for="categoryName" class="block text-sm font-medium text-[#9dabb9] mb-2">Tên danh mục</label>
                <input type="text" id="categoryName" name="Name" required
                    class="w-full px-4 py-3 bg-[#283039] border border-[#3b4754] rounded-lg text-white placeholder-[#9dabb9] focus:border-primary focus:ring-1 focus:ring-primary transition-all"
                    placeholder="Nhập tên danh mục..."/>
            </div>
            <div class="flex gap-3 justify-end">
                <button type="button" onclick="closeAddModal()" class="px-4 py-2.5 rounded-lg text-[#9dabb9] hover:text-white hover:bg-[#283039] transition-colors">
                    Hủy
                </button>
                <button type="submit" class="px-4 py-2.5 bg-primary hover:bg-primary/90 text-white rounded-lg font-medium transition-colors">
                    Thêm danh mục
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function openAddModal() {
            document.getElementById('addCategoryModal').classList.remove('hidden');
            document.getElementById('addCategoryModal').classList.add('flex');
            document.getElementById('categoryName').focus();
        }

        function closeAddModal() {
            document.getElementById('addCategoryModal').classList.add('hidden');
            document.getElementById('addCategoryModal').classList.remove('flex');
            document.getElementById('categoryName').value = '';
        }

        // Close modal when clicking outside
        document.getElementById('addCategoryModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAddModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAddModal();
            }
        });
    </script>
}
